import{s as J}from"./socialParticipantService-DTx0ZKfe.js";import{s as B}from"./socialService-CIlbb4TN.js";import{_ as K,i as O,r as m,$ as W,e as X,g as d,o as r,H as t,f as a,d as H,m as y,w as s,ad as v,ae as D,p,F as g,n as w,t as n,k as S,af as P,ag as F,am as I,j as Y,aC as Z,A as tt}from"./index-CAC0_XLU.js";import{d as et}from"./dayjs.min-CFWPjdno.js";import{a as M,V as N}from"./VRow-Dh2JWpQL.js";import{V as T}from"./VTable-DyqPTk0v.js";import{V as R}from"./VAlert-BOSHZiVR.js";import"./_commonjsHelpers-gnU0ypJ3.js";const lt={class:"pt-8 bg-light"},at={key:0},st={key:0},nt={__name:"beingHost",setup(ot){const Q=O(),U=m(!1);m([]);const k=m([]),h=m([]),_=m({open:!1,id:""}),u=m([]),b=m([]),V=m([]),q=async o=>{_.value.open=!0,_.value.id=o._id,await G(o)},$=()=>{_.value.open=!1,_.value.id=""},L=m(""),x=m({open:!1,id:""}),j=async o=>{x.value.open=!0,x.value.id=o._id,await z(o)},A=()=>{x.value.open=!1,x.value.id=""},z=async o=>{try{const e=o._id,{data:i}=await B.getQrCode(e);L.value=i.qrCodeDataUrl,console.log("qrCodeDataUrl",L.value)}catch(e){console.error("Qrcode 取得失敗:",e),Q({text:"無法載入 Qrcode，請重新整理或稍後再試",snackbarProps:{color:"red"}}),A()}},E=async()=>{U.value=!0;try{const{data:o}=await tt.profile(),e=o.user._id,{data:i}=await B.getAll({time:"upcoming"});i.success&&(k.value=i.socials||[].filter(c=>{var f;return((f=c.host)==null?void 0:f._id)===e})),console.log("即將到來的場次:",k.value);const{data:l}=await B.getAll({time:"past"});l.success&&(h.value=l.socials||[].filter(c=>{var f;return((f=c.host)==null?void 0:f._id)===e})),console.log("已過期的場次:",h.value)}catch(o){console.error("揪團紀錄取得失敗:",o),Q({text:"無法載入揪團紀錄，請重新整理或稍後再試",snackbarProps:{color:"red"}})}},G=async o=>{try{const e=o._id,{data:i}=await J.getParticipantsList(e);u.value=i.participantsList,b.value=u.value.filter(l=>l.user.gender==="female"),V.value=u.value.filter(l=>l.user.gender==="male"),console.log("femalePlayers",b.value),console.log("malePlayers",V.value)}catch(e){console.error("球員名單取得失敗:",e),Q({text:"無法載入球員名單，請重新整理或稍後再試",snackbarProps:{color:"red"}})}},C=o=>o?et(o).format("HH:mm"):"";return W(()=>{E()}),(o,e)=>{const i=X("v-icon-btn");return r(),d(g,null,[t("div",lt,[a(N,{justify:"center"},{default:s(()=>[a(M,{cols:"12",md:"10"},{default:s(()=>[a(v,{class:"pa-16 rounded-lg"},{default:s(()=>[t("div",null,[e[2]||(e[2]=t("div",null,[t("h1",{class:"font-weight-bold text-h4"},"揪團紀錄")],-1)),a(D,{thickness:2,opacity:"20",class:"mt-5"})]),a(D,{class:"my-4"}),a(N,{class:"mt-4 align-center"},{default:s(()=>[a(M,{cols:"12"},{default:s(()=>[a(v,{class:"pa-4 rounded-lg"},{default:s(()=>[e[7]||(e[7]=t("h2",{class:"mb-4 text-h5 font-weight-bold"},"即將開打",-1)),a(T,{height:"300px","fixed-header":"",striped:"even"},{default:s(()=>[k.value.length===0?(r(),H(R,{key:0,type:"info",class:"mt-4"},{default:s(()=>e[3]||(e[3]=[p(" 目前沒有您的揪團紀錄 ",-1)])),_:1,__:[3]})):y("",!0),e[6]||(e[6]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"球場"),t("th",{class:"text-left"},"時段"),t("th",{class:"text-left"},"價格"),t("th",{class:"text-left"},"球員名單"),t("th",{class:"text-left"},"出席登入"),t("th",{class:"text-left"},"備註")])],-1)),t("tbody",null,[(r(!0),d(g,null,w(k.value,(l,c)=>(r(),d("tr",{key:c},[t("td",null,n(l.venue.name),1),t("td",null,n(C(l.startDateTime))+" - "+n(C(l.endDateTime)),1),t("td",null,n(l.fee),1),t("td",null,[a(S,{onClick:f=>q(l),class:"btn"},{default:s(()=>e[4]||(e[4]=[p("球員名單",-1)])),_:2,__:[4]},1032,["onClick"])]),t("td",null,[a(S,{class:"btn",onClick:f=>j(l)},{default:s(()=>e[5]||(e[5]=[p("QR Code",-1)])),_:2,__:[5]},1032,["onClick"])]),t("td",null,n(l.note),1)]))),128))])]),_:1,__:[6]})]),_:1,__:[7]}),a(v,{class:"pa-4 rounded-lg mt-8"},{default:s(()=>[e[11]||(e[11]=t("h2",{class:"mb-4 text-h5 font-weight-bold"},"過去一個月",-1)),a(T,{height:"300px","fixed-header":"",striped:"even"},{default:s(()=>[h.value.length===0?(r(),H(R,{key:0,type:"info",class:"mt-4"},{default:s(()=>e[8]||(e[8]=[p(" 目前沒有您的揪團紀錄 ",-1)])),_:1,__:[8]})):y("",!0),e[10]||(e[10]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"球場"),t("th",{class:"text-left"},"時段"),t("th",{class:"text-left"},"價格"),t("th",{class:"text-left"},"球員名單"),t("th",{class:"text-left"},"備註")])],-1)),t("tbody",null,[(r(!0),d(g,null,w(h.value,(l,c)=>{var f;return r(),d("tr",{key:c},[t("td",null,n(((f=l.venue)==null?void 0:f.name)||"未知場地"),1),t("td",null,n(C(l.startDateTime))+" - "+n(C(l.endDateTime)),1),t("td",null,n(l.fee),1),t("td",null,[a(S,{class:"btn",onClick:rt=>q(l)},{default:s(()=>e[9]||(e[9]=[p("球員名單",-1)])),_:2,__:[9]},1032,["onClick"])]),t("td",null,n(l.note),1)])}),128))])]),_:1,__:[10]})]),_:1,__:[11]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),a(I,{modelValue:_.value.open,"onUpdate:modelValue":e[0]||(e[0]=l=>_.value.open=l),persistent:"",width:"800"},{default:s(()=>[a(v,{rounded:"lg",class:"card-dialog"},{default:s(()=>[a(P,{class:"text-center mt-3 page-title"},{default:s(()=>e[12]||(e[12]=[p("球員名單",-1)])),_:1,__:[12]}),a(i,{icon:"mdi-close",onClick:$,class:"btn btn-close"}),a(D,{thickness:"2",opacity:"20",color:"black",class:"mx-auto",width:"25%"}),a(F,null,{default:s(()=>[a(v,{class:"card-players"},{default:s(()=>[a(P,null,{default:s(()=>[e[13]||(e[13]=p("女性球員 ",-1)),u.value.length>0&&u.value[0].social?(r(),d(g,{key:0},[p("（需求人數："+n(u.value[0].social.demandFemalePlayers)+"/ 已報名人數："+n(u.value[0].social.currentFemalePlayers)+"）",1)],64)):y("",!0)]),_:1,__:[13]}),a(T,{height:"300px","fixed-header":"",striped:"even"},{default:s(()=>[e[15]||(e[15]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"球員"),t("th",{class:"text-left"},"程度"),t("th",{class:"text-left"},"出席率"),t("th",{class:"text-left"},"狀態"),t("th",{class:"text-left"},"操作")])],-1)),t("tbody",null,[b.value.length===0?(r(),d("tr",at,e[14]||(e[14]=[t("td",null,"目前還沒有球員報名喔，趕快揪人去~",-1)]))):(r(!0),d(g,{key:1},w(b.value,(l,c)=>(r(),d("tr",{key:c},[t("td",null,n(l.user.name),1),t("td",null,n(l.user.skillLevel),1),t("td",null,n(l.user.attendanceRate)+" ("+n(l.user.attendancePresent)+" / "+n(l.user.attendanceTotal)+") ",1),t("td",null,n(l.status),1),t("td",null,[a(i,{icon:"mdi-pencil"})])]))),128))])]),_:1,__:[15]})]),_:1}),a(v,{class:"mt-5 card-players"},{default:s(()=>[a(P,null,{default:s(()=>[u.value.length>0&&u.value[0].social?(r(),d(g,{key:0},[p(" 男性球員（需求人數："+n(u.value[0].social.demandMalePlayers)+"/ 已報名人數："+n(u.value[0].social.currentMalePlayers)+"）",1)],64)):y("",!0)]),_:1}),a(T,{height:"300px","fixed-header":"",striped:"even"},{default:s(()=>[e[17]||(e[17]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"球員"),t("th",{class:"text-left"},"程度"),t("th",{class:"text-left"},"出席率"),t("th",{class:"text-left"},"狀態"),t("th",{class:"text-left"},"操作")])],-1)),t("tbody",null,[V.value.length===0?(r(),d("tr",st,e[16]||(e[16]=[t("td",{style:{"font-size":"1rem"}},"目前還沒有球員報名喔，趕快揪人去~",-1)]))):(r(!0),d(g,{key:1},w(V.value,(l,c)=>(r(),d("tr",{key:c},[t("td",null,n(l.user.name),1),t("td",null,n(l.user.skillLevel),1),t("td",null,n(l.user.attendanceRate)+"("+n(l.user.attendancePresent)+"/"+n(l.user.attendanceTotal)+") ",1),t("td",null,n(l.status),1),t("td",null,[a(i,{icon:"mdi-pencil"})])]))),128))])]),_:1,__:[17]})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(I,{modelValue:x.value.open,"onUpdate:modelValue":e[1]||(e[1]=l=>x.value.open=l),persistent:"",width:"500"},{default:s(()=>[a(v,{rounded:"lg",class:"card-dialog"},{default:s(()=>[a(P,{class:"text-center mt-3 page-title"},{default:s(()=>e[18]||(e[18]=[p("出席登入 Qrcode",-1)])),_:1,__:[18]}),a(i,{icon:"mdi-close",onClick:A,class:"btn btn-close"}),a(D,{thickness:"2",opacity:"20",color:"black",class:"mx-auto",width:"25%"}),a(F,null,{default:s(()=>[a(Y,{src:L.value},null,8,["src"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),U.value?(r(),H(Z,{key:0,indeterminate:"",color:"primary"})):y("",!0)],64)}}},gt=K(nt,[["__scopeId","data-v-14e01df8"]]);export{gt as default};
