import{s as p}from"./socialParticipantService-BoToaA_g.js";import{d as i}from"./dayjs.min-CFWPjdno.js";import{u as Y,t as H}from"./timezone-HNTdC97K.js";import{_ as I,r as f,i as N,$,e as j,g as d,o as u,H as t,f as s,w as n,ar as g,a9 as k,F as y,p as P,t as o,as as F,q as h,ax as q,k as T,ay as E}from"./index-Dm7nCjjk.js";import{a as w,V as C}from"./VRow-Dt6IMYhC.js";import{V as M}from"./VTable-DJc5nfiD.js";import"./_commonjsHelpers-gnU0ypJ3.js";const L={class:"pt-8 bg-light"},R={__name:"socials",setup(U){i.extend(Y),i.extend(H),i.tz.setDefault("Asia/Taipei");const z=f([]),x=f([]),v=f([]),c=N(),r=f({open:!1,id:"",message:"再考慮一下，確定要取消報名嗎？"}),B=l=>{console.log("participation",l),r.value.open=!0,r.value.id=l.social._id},b=()=>{r.value.open=!1,r.value.id=""},A=async()=>{try{const l=r.value.id;if(console.log("要取消報名的 socialId:",l),(await p.update(l,{status:"已取消報名"})).data.message==="已過取消報名期限，如臨時無法出席，請自行找人補。")return c({text:"已過取消報名期限，如臨時無法出席，請自行找人補。",snackbarProps:{color:"red"}});b(),c({text:"已取消報名該場次！如果改變心意了，可以再到報名頁面報名喔~",snackbarProps:{color:"green"}}),await V()}catch(l){console.error("無法修改報名狀態",l),c({text:"無法修改報名狀態，請重新整理或稍後再試",snackbarProps:{color:"red"}})}},D=l=>l?i.utc(l).tz("Asia/Taipei").format("YYYY-MM-DD"):"",m=l=>l?i.utc(l).tz("Asia/Taipei").format("HH:mm"):"",V=async()=>{try{z.value=await p.getMyParticipations();const{data:l}=await p.getMyParticipations({time:"upcoming"});x.value=l.myParticipations,console.log("即將到來的場次:",x.value);const{data:e}=await p.getMyParticipations({time:"past"});v.value=e.myParticipations,console.log("已過期的場次:",v.value)}catch(l){console.error("打 play 紀錄取得失敗:",l),c({text:"無法載入打 play 紀錄，請重新整理或稍後再試",snackbarProps:{color:"red"}})}};return $(()=>{V()}),(l,e)=>{const S=j("v-icon-btn");return u(),d(y,null,[t("div",L,[s(C,{justify:"center"},{default:n(()=>[s(w,{cols:"12",md:"10"},{default:n(()=>[s(g,{class:"pa-16 rounded-lg card-memberPage"},{default:n(()=>[t("div",null,[t("div",null,[e[2]||(e[2]=t("h1",{class:"font-weight-bold text-h4"},"打 play 紀錄",-1)),s(k,{thickness:2,opacity:"20",class:"mt-5"})])]),s(k,{class:"my-4"}),s(C,{class:"mt-4 align-center"},{default:n(()=>[s(w,{cols:"12"},{default:n(()=>[s(g,{class:"pa-4 rounded-lg card-memberPage"},{default:n(()=>[e[4]||(e[4]=t("h2",{class:"mb-4 font-weight-bold",style:{"font-size":"1.3rem"}},"即將開打的場次",-1)),s(M,{height:"300px","fixed-header":"",striped:"even"},{default:n(()=>[e[3]||(e[3]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"球場"),t("th",{class:"text-left"},"日期"),t("th",{class:"text-left"},"時段"),t("th",{class:"text-left"},"價格"),t("th",{class:"text-left"},"主揪"),t("th",{class:"text-left"},"狀態"),t("th",{class:"text-left"},"備註"),t("th",{class:"text-left"},"操作")])],-1)),t("tbody",null,[(u(!0),d(y,null,P(x.value,(a,_)=>(u(),d("tr",{key:_},[t("td",null,o(a.social.venue.name),1),t("td",null,o(D(a.social.startDateTime)),1),t("td",null,o(m(a.social.startDateTime))+" - "+o(m(a.social.endDateTime)),1),t("td",null,o(a.social.fee),1),t("td",null,o(a.social.host.name),1),t("td",null,o(a.status),1),t("td",null,o(a.note),1),t("td",null,[s(S,{icon:"mdi-delete",class:"deleteBtn",title:"取消報名",onClick:G=>B(a)},null,8,["onClick"])])]))),128))])]),_:1,__:[3]})]),_:1,__:[4]}),s(g,{class:"pa-4 rounded-lg mt-8 card-memberPage"},{default:n(()=>[e[6]||(e[6]=t("h2",{class:"mb-4 font-weight-bold",style:{"font-size":"1.3rem"}},"已結束的場次",-1)),s(M,{height:"300px","fixed-header":"",striped:"even"},{default:n(()=>[e[5]||(e[5]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"球場"),t("th",{class:"text-left"},"日期"),t("th",{class:"text-left"},"時段"),t("th",{class:"text-left"},"價格"),t("th",{class:"text-left"},"主揪"),t("th",{class:"text-left"},"狀態"),t("th",{class:"text-left"},"備註")])],-1)),t("tbody",null,[(u(!0),d(y,null,P(v.value,(a,_)=>(u(),d("tr",{key:_},[t("td",null,o(a.social.venue.name),1),t("td",null,o(D(a.social.startDateTime)),1),t("td",null,o(m(a.social.startDateTime))+" - "+o(m(a.social.endDateTime)),1),t("td",null,o(a.social.fee),1),t("td",null,o(a.social.host.name),1),t("td",null,o(a.status),1),t("td",null,o(a.note),1)]))),128))])]),_:1,__:[5]})]),_:1,__:[6]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),s(E,{modelValue:r.value.open,"onUpdate:modelValue":e[1]||(e[1]=a=>r.value.open=a),persistent:"",width:"350"},{default:n(()=>[s(g,{rounded:"lg"},{default:n(()=>[s(F,{class:"text-center mt-3"},{default:n(()=>[h(o(r.value.message),1)]),_:1}),s(q,null,{default:n(()=>[s(T,{color:"red",onClick:e[0]||(e[0]=a=>A(l.social))},{default:n(()=>e[7]||(e[7]=[h("確定取消",-1)])),_:1,__:[7]}),s(T,{color:"black",onClick:b},{default:n(()=>e[8]||(e[8]=[h("關閉視窗",-1)])),_:1,__:[8]})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}},tt=I(R,[["__scopeId","data-v-42f401d8"]]);export{tt as default};
