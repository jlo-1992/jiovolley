import{_ as G,i as H,aD as K,r as i,A as S,$ as O,e as J,g as C,o as L,H as n,m as Q,f as a,w as t,ad as P,l as W,h as s,ae as M,aA as X,j as Y,ah as v,k as c,p as f,aE as Z,F as ee}from"./index-CAC0_XLU.js";import{_ as ae}from"./passing-CouDye6I.js";import{u as le,c as se,a as g,d,V as te}from"./vee-validate-DQw0GQGx.js";import{v as oe}from"./index-Dcj7LDNL.js";import{a as u,V}from"./VRow-Dh2JWpQL.js";import{V as B}from"./VSelect-D0ikHo3x.js";import"./_commonjsHelpers-gnU0ypJ3.js";import"./VList-glTZcd9s.js";const re={class:"pt-8 bg-light"},ue={key:0,class:"lottie-overlay"},ne={__name:"profile",setup(de){const m=H();K("fileAgent"),i([]),i([]);const{handleSubmit:E,isSubmitting:N,setValues:R}=le({validationSchema:se({name:g().required("球場名稱必填").min(1,"球場名稱不能為空"),gender:g().required("性別必填"),email:g().required("電子郵件必填").test("isEmail","請輸入有效的電子郵件地址",o=>oe.isEmail(o)),skillLevel:g().required("球技程度必填")})}),b=d("name"),_=d("gender"),y=d("email"),k=d("skillLevel"),w=d("password"),x=d("line_uid"),D=d("google_uid"),U=i(""),F=i(null),h=i(null),q=i(null),j=()=>{q.value.click()},A=async()=>{try{const{data:o}=await S.profile(),e=o.user;R({name:e.name,gender:e.gender,email:e.email,skillLevel:e.skillLevel,password:e.password,line_uid:e.line_uid,google_uid:e.google_uid}),U.value=e.avatar,F.value=null,h.value=null}catch(o){console.error("會員資料取得失敗:",o),m({text:"無法載入會員資料，請重新整理或稍後再試",snackbarProps:{color:"red"}})}},T=E(async o=>{var e,r;try{await S.updateProfile(o),m({text:"球員資料編輯成功！",snackbarProps:{color:"green"}}),await A()}catch(l){console.error(l),m({text:((r=(e=l==null?void 0:l.response)==null?void 0:e.data)==null?void 0:r.message)||"球員資料編輯失敗，請稍後再試！",snackbarProps:{color:"red"}})}}),$=async o=>{const e=o.target.files[0];if(e){const r=new FileReader;r.onload=l=>{F.value=l.target.result},r.readAsDataURL(e),await z(e)}},z=async o=>{var e,r;try{const l=new FormData;l.append("avatar",o);const{data:I}=await S.updateProfile(l);I.user&&I.user.avatar&&(U.value=I.user.avatar,F.value=null,h.value=null),m({text:"照片更新成功！",snackbarProps:{color:"green"}})}catch(l){console.error("照片上傳失敗:",l),m({text:((r=(e=l==null?void 0:l.response)==null?void 0:e.data)==null?void 0:r.message)||"照片更新失敗，請稍後再試！",snackbarProps:{color:"red"}})}},p={required:o=>!!o||"此欄位為必填."};return O(()=>{A()}),(o,e)=>{const r=J("v-icon-btn");return L(),C(ee,null,[n("div",re,[a(V,{justify:"center"},{default:t(()=>[a(u,{cols:"12",md:"10"},{default:t(()=>[a(P,{class:"pa-16 rounded-lg"},{default:t(()=>[a(te,{onSubmit:W(s(T),["prevent"])},{default:t(()=>[n("div",null,[n("div",null,[e[7]||(e[7]=n("h1",{class:"font-weight-bold text-h4"},"球員資料",-1)),a(M,{thickness:2,opacity:"20",class:"mt-5"})])]),a(M,{class:"my-4"}),a(V,{class:"align-start"},{default:t(()=>[a(u,{cols:"12",md:"2",class:"mt-16 ml-14"},{default:t(()=>[a(X,{size:"100"},{default:t(()=>[a(Y,{src:ae,class:"avatar-img",cover:""})]),_:1}),n("input",{type:"file",ref_key:"fileInput",ref:q,onChange:$,style:{display:"none"},accept:"image/*"},null,544),a(r,{variant:"tonal",style:{"background-color":"#f1f1f1"},icon:"mdi-pencil",class:"mt-15 ml-n7",onClick:j})]),_:1}),a(u,{cols:"12",sm:"9",md:"9"},{default:t(()=>[a(P,{class:"pa-4 rounded-lg"},{default:t(()=>[e[9]||(e[9]=n("h3",{class:"text-h6 font-weight-bold mb-4"},"一般資訊",-1)),a(V,null,{default:t(()=>[a(u,{cols:"12",sm:"6"},{default:t(()=>[a(v,{label:"姓名",modelValue:s(b).value.value,"onUpdate:modelValue":e[0]||(e[0]=l=>s(b).value.value=l),"error-messages":s(b).errorMessage.value,variant:"outlined","hide-details":"",rules:[p.required]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(u,{cols:"12",sm:"6"},{default:t(()=>[a(B,{label:"性別",modelValue:s(_).value.value,"onUpdate:modelValue":e[1]||(e[1]=l=>s(_).value.value=l),"error-messages":s(_).errorMessage.value,variant:"outlined","hide-details":"",items:["女性","男性"],rules:[p.required]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(u,{cols:"12",sm:"6"},{default:t(()=>[a(v,{label:"Email",modelValue:s(y).value.value,"onUpdate:modelValue":e[2]||(e[2]=l=>s(y).value.value=l),"error-messages":s(y).errorMessage.value,variant:"outlined","hide-details":"",rules:[p.required]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(u,{cols:"12",sm:"6"},{default:t(()=>[a(B,{label:"球技程度",modelValue:s(k).value.value,"onUpdate:modelValue":e[3]||(e[3]=l=>s(k).value.value=l),"error-messages":s(k).errorMessage.value,variant:"outlined","hide-details":"",items:["S 體保生","A 一般生校隊","B 一般生系隊","C 排球初階","D 排球初心者"],rules:[p.required]},null,8,["modelValue","error-messages","rules"])]),_:1})]),_:1}),a(c,{class:"mt-4 btn",type:"submit"},{default:t(()=>e[8]||(e[8]=[f("更新球員資料",-1)])),_:1,__:[8]})]),_:1,__:[9]}),a(P,{class:"pa-4 rounded-lg mt-8"},{default:t(()=>[e[13]||(e[13]=n("h3",{class:"text-h6 font-weight-bold mb-4"},"機密資訊",-1)),a(V,null,{default:t(()=>[a(u,{cols:"12",sm:"4"},{default:t(()=>[a(v,{label:"Password",type:"password",modelValue:s(w).value.value,"onUpdate:modelValue":e[4]||(e[4]=l=>s(w).value.value=l),"error-messages":s(w).errorMessage.value,variant:"outlined","hide-details":"",readonly:""},null,8,["modelValue","error-messages"]),a(c,{class:"mt-4",color:"#353d42",variant:"outlined",type:"submit",block:""},{default:t(()=>e[10]||(e[10]=[f("更改密碼",-1)])),_:1,__:[10]})]),_:1}),a(u,{cols:"12",sm:"4"},{default:t(()=>[a(v,{label:"Line ID",modelValue:s(x).value.value,"onUpdate:modelValue":e[5]||(e[5]=l=>s(x).value.value=l),"error-messages":s(x).errorMessage.value,variant:"outlined","hide-details":"",readonly:""},null,8,["modelValue","error-messages"]),a(c,{class:"mt-4",color:"#353d42",type:"submit",variant:"outlined",block:""},{default:t(()=>e[11]||(e[11]=[f("更改 Line ID",-1)])),_:1,__:[11]})]),_:1}),a(u,{cols:"12",sm:"4"},{default:t(()=>[a(v,{label:"Google ID",modelValue:s(D).value.value,"onUpdate:modelValue":e[6]||(e[6]=l=>s(D).value.value=l),"error-messages":s(D).errorMessage.value,variant:"outlined","hide-details":"",readonly:""},null,8,["modelValue","error-messages"]),a(c,{class:"mt-4",color:"#353d42",type:"submit",variant:"outlined",block:""},{default:t(()=>e[12]||(e[12]=[f("更改 Google ID",-1)])),_:1,__:[12]})]),_:1})]),_:1})]),_:1,__:[13]})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1}),e[14]||(e[14]=n("div",{class:"bottom-decoration d-flex justify-end pr-8",style:{position:"fixed",bottom:"0",width:"100%","z-index":"-1"}},null,-1))]),s(N)?(L(),C("div",ue,[a(s(Z),{style:{height:"500px",width:"500px"},autoplay:"",loop:"",src:"https://lottie.host/4583ad3e-73e1-4f3a-83d5-048a1943aaa7/gPKIV1O45e.lottie"})])):Q("",!0)],64)}}},be=G(ne,[["__scopeId","data-v-6aefb178"]]);export{be as default};
